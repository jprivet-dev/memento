:MAIN_TITLE: Symfony 3

include::_partials/adoc-config.adoc[]

== Présentation

Symfony est un framework PHP créé par Fabien Potentier et éditer par la sotiété SensioLabs.

NOTE: Un framework sert à améliorer la productivité des développeurs

|===
|Version maintenue de Sf |Date de sortie |Version min de PHP requis
|Symfony 1      |2005 |
|Symfony 2.8    |2011 |PHP 5.3.9
|Symfony 3.4    |2015 |PHP 5.5.9
|Symfony 4.0    |2018 |PHP 7.1.3
|===

== Création d'un nouveau projet

[source,bash]
----
$ symfony new my_project_name 3.4

# Use the most recent 'lts' version (Long Term Support version)
$ symfony new my_project_name lts
----

== L'architecture de Symfony

----
.
|-- app/        # Configuration & Templates
|-- bin/        # Exécutables (commandes PHP, bin\console, ...)
|-- src/        # Code source (bundles, ...)
|-- tests/      # Tests unitaires
|-- var/        # Logs, cache, ...
|-- vendor/     # Libs externes
`-- web/        # Fichiers destinés aux visiteurs (img, css, js)
                # Contrôleurs frontaux `app.php` & `app_dev.php`
----

=== Mode dev & debug

TIP: Vous pouvez avoir accès à l'outils profiler en allant sur  http://localhost/my_new_project/web/app_dev.php/_profiler

TIP: En production, les erreurs sont loggées dans le fichier `var/logs/prod.log`

== L'architecture basique conceptuelle MVC

- `M` pour `Model` : Gestion des données et des contenus.
- `V` pour `View` : Affichage des pages.
- `C` pour `Controller` : Analyse et traitement de la requête HTTP.

=== Parcours d'une requête dans Symfony

image::symfony3/img/parcours-requete.png[]

== Les bundles

NOTE: Un bundle est une brique de l'application. Il contient tout ce qui concerne une même fonctionnalité (contrôleurs, modèles, vues, css, js, ...).

TIP: http://knpbundles.com regroupe persque tous les bundles de la communauté Symfony.

=== Structure d'un bundle

----
.
|-- Controller/                 # Contrôleurs de l'application
|-- DependencyInjection/        # Information du bundle
|-- Entity/                     # Modèles
|-- Form/                       # Formulaires
`-- Resources/
    |-- config/                 # Configuration du bundle (ex: routes)
    |-- public/                 # Fichiers publics (css, js, images, ...)
    `-- views/                  # Vues du bundles (Twig)
----

=== Création d'un bundle avec la console

WARNING: Il y a une différence de commande entre la version 2 et 3 de Symfony pour l'exécutable.

[source,bash]
----
$ php bin/console generate:bundle   # Symfony 3
$ php app/console generate:bundle   # Symfony 2
----

==== Génération du bundle

[source,bash]
----
$ php bin/console generate:bundle
----

Le générateur va poser plusieurs questions :

[source,bash]
----
# 1 - Cadre de réutilisation du bundle
Are you planning on sharing this bundle across multiple applications? [no]:yes

# 2 - Choix du namespace
Bundle namespace: OC/PlatformBundle

# 3 - Choix du nom
Bundle name [OCPlatformBundle]:_

# 4 - Choix de la destination
Target Directory [src/]:_

# 5 - Choix du format de configuration
Configuration format (annotation, yml, xml, php) [xml]:_
----

Symfony a généré la structure du bundle dans le répertoire `src/OC/PlatformBundle`.

TIP: Le seul fichier obligatoire pour la création du bundle est la classe à la racine `OCPlatformBundle.php`

Il a aussi enregistré le bundle auprès du Kernel `app/AppKernel.php`.

Le bundle dispose de ses propres routes :

.src/OC/PlatformBundle/Resources/config/routing.yml
----
oc_platform_homepage:
    path:       /
    defaults:   { _controller: OCPlatformBundle:Default:index } <1>
----
<1> `OCPlatformBundle:Default:index` pointe le controlleur `src/OC/PlatformBundle/Controller/DefaultController.php`.

Ce fichier est ensuite importé dans le fichier de routing global de l'application. Symfony a aussi généré ces lignes de configuration.

.app/config/routing.yml
----
oc_platform :
    resource:   "@OCPlatformBundle/Resources/config/routing.yml"
    prefix:     /
----

== Ressources

- https://openclassrooms.com/fr/courses/3619856-developpez-votre-site-web-avec-le-framework-symfony
- https://symfony.com/doc/3.4/setup.html


{BACK_TO_TOP}
